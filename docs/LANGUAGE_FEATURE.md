# 语言选择功能实现文档

## 功能概述

为 WriteAI 添加了根据当前选择的 AI 模型动态显示支持语言的功能。

## 实现内容

### 1. 语言配置数据结构 (`app/config/languageConfig.ts`)

#### 支持的语言列表

定义了 30 种语言，包括：

- 常用语言：中文、英语、日语、韩语、法语、德语、西班牙语等
- 其他语言：葡萄牙语、俄语、意大利语、阿拉伯语、印地语、泰语、越南语等

#### 模型-语言映射关系

```typescript
MODEL_LANGUAGE_SUPPORT = {
  "qwen-plus": [17种语言],
  "qwen-max": [30种语言],
  "gemini-1.0-pro": [19种语言],
  "gemini-1.5-pro": [27种语言],
  "gpt-3.5-turbo": [27种语言],
  "gpt-4": [30种语言],
  // ...更多模型
}
```

#### 辅助函数

- `getSupportedLanguages(modelName)`: 获取指定模型支持的语言列表
- `isLanguageSupported(modelName, languageKey)`: 检查模型是否支持指定语言
- `LANGUAGE_NAMES`: 语言键到自然语言名称的映射（用于 AI 提示词）

### 2. 数据模型更新

#### ArticleState (Store)

```typescript
interface ArticleState {
  language: string; // 新增：语言字段
  setLanguage: (value: string) => void; // 新增：设置语言方法
  // ...其他字段
}
```

#### HistoryItem (Types)

```typescript
interface HistoryItem {
  language: string; // 新增：记录生成时使用的语言
  // ...其他字段
}
```

### 3. UI 实现

#### 语言选择器位置

- 位于关键词输入框下方的选项栏
- 与"文章长度"、"写作风格"、"文章类型"并列
- 使用地球图标 (Globe) 标识

#### 交互设计

```
┌─────────────────────────────────────┐
│  [短文 ▼] [正式专业 ▼] [博客文章 ▼] [🌐 中文 ▼] │
└─────────────────────────────────────┘
                    ↓ 点击展开
┌───────────────────────────────────────────┐
│ 输出语言（当前模型支持 17 种语言）          │
│ ┌────┬────┬────┬────┐                    │
│ │中文│英语│日语│韩语│                    │
│ ├────┼────┼────┼────┤                    │
│ │法语│德语│西班│葡萄│                    │
│ │    │    │牙语│牙语│                    │
│ └────┴────┴────┴────┘                    │
│         ...更多语言...                     │
└───────────────────────────────────────────┘
```

#### 样式特点

- **网格布局**: 每行显示 4 种语言
- **当前选中**: 紫色背景 + 白色文字
- **未选中**: 灰色背景 + 悬停效果
- **响应式**: 自动适应内容宽度

### 4. 智能联动

#### 模型切换时自动检查

```typescript
useEffect(() => {
  // 当前模型不支持已选语言时，自动切换到中文
  if (!isLanguageSupported(currentModel, language)) {
    setLanguage("chinese");
  }
}, [currentModel, language]);
```

#### 实时显示支持的语言

- 根据当前选择的 AI 提供商（Qwen/Gemini/ChatGPT）
- 根据当前选择的模型版本（qwen-plus/gemini-1.5-pro/gpt-4 等）
- 动态显示该模型支持的语言列表

### 5. AI 提示词集成

#### 提示词模板更新

```
## 文章要求

- **关键词**: {{keywords}}
- **文章长度**: {{articleLength}}
- **写作风格**: {{writingStyle}}
- **文章类型**: {{articleType}}
- **输出语言**: {{language}} - **请使用此语言撰写所有内容（包括标题、正文和标签）**
```

#### 语言名称格式

使用双语标注确保 AI 理解：

```typescript
{
  chinese: "Chinese (中文)",
  english: "English",
  japanese: "Japanese (日本語)",
  korean: "Korean (한국어)",
  // ...
}
```

## 使用流程

### 用户操作流程

1. **选择 AI 提供商**：在设置中选择 Qwen/Gemini/ChatGPT
2. **选择模型版本**：如 qwen-plus, gemini-1.5-pro, gpt-4
3. **选择语言**：点击语言按钮，从支持的语言列表中选择
4. **输入关键词**：输入要生成的文章关键词
5. **生成文章**：AI 将使用选定的语言生成所有内容

### 自动化行为

- ✅ 切换模型时，自动检查语言兼容性
- ✅ 不兼容时自动切换到中文
- ✅ 语言选项实时更新，只显示当前模型支持的语言
- ✅ 历史记录保存语言信息

## 技术亮点

### 1. 数据驱动

- 集中管理语言配置
- 易于添加新语言和新模型
- 维护性强

### 2. 类型安全

- TypeScript 完整类型定义
- 编译时错误检查
- IDE 智能提示

### 3. 用户体验

- 网格布局，一目了然
- 智能联动，避免错误
- 视觉反馈清晰

### 4. 可扩展性

- 新增语言：只需在 `ALL_LANGUAGES` 添加
- 新增模型：只需在 `MODEL_LANGUAGE_SUPPORT` 添加映射
- 修改支持范围：直接修改配置数组

## 模型语言支持对比

| 模型                 | 支持语言数 | 特点           |
| -------------------- | ---------- | -------------- |
| qwen-turbo           | 17         | 基础多语言支持 |
| qwen-plus            | 20         | 增强多语言支持 |
| qwen-max             | 30         | 全语言支持     |
| gemini-1.0-pro       | 19         | 主流语言支持   |
| gemini-1.5-pro       | 27         | 广泛语言支持   |
| gemini-2.0-flash-exp | 29         | 最新全语言支持 |
| gpt-3.5-turbo        | 27         | 主流语言支持   |
| gpt-4                | 30         | 全语言支持     |
| gpt-4-turbo          | 30         | 全语言支持     |

## 文件清单

### 新增文件

- `app/config/languageConfig.ts` - 语言配置和映射关系

### 修改文件

- `app/types/index.ts` - 添加 language 字段到 HistoryItem
- `app/store/articleStore.ts` - 添加 language 状态和方法
- `app/utils/promptGenerator.ts` - 添加 language 参数到提示词
- `app/page.tsx` - 实现语言选择 UI 和联动逻辑

## 测试建议

### 功能测试

1. ✅ 测试不同模型切换时语言选项是否正确更新
2. ✅ 测试选择不支持的语言后切换模型是否自动切换到中文
3. ✅ 测试各种语言生成文章是否正确
4. ✅ 测试历史记录是否正确保存语言信息

### 边界测试

1. ✅ 模型名称不在配置中时的降级处理
2. ✅ 语言键不在映射中时的默认行为
3. ✅ 快速切换模型时的状态一致性

## 未来扩展方向

1. **语言分组**：按地区/语系分组显示
2. **热门语言**：将常用语言置顶显示
3. **搜索功能**：语言过多时支持搜索
4. **自动检测**：根据关键词自动推荐语言
5. **多语言输出**：一次生成多种语言版本
