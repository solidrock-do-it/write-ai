# 代理服务器配置说明

## 功能概述

WriteAI 支持通过代理服务器访问 AI API，这在以下场景特别有用：

- 需要通过公司代理访问外网
- 使用本地代理工具（如 Clash、V2Ray 等）
- 需要通过特定网络路径访问 AI 服务

## 如何配置

### 1. 打开设置

点击左侧边栏底部的"设置"按钮

### 2. 启用代理

在"代理服务器设置"部分：

1. 打开"启用代理服务器"开关
2. 输入代理服务器地址

### 3. 代理地址格式

代理地址必须包含协议前缀（http:// 或 https://），例如：

**本地代理示例：**

- `http://localhost:7890` - Clash 默认端口
- `http://127.0.0.1:10809` - V2Ray 默认端口
- `http://localhost:1087` - Shadowsocks 默认端口

**远程代理示例：**

- `https://proxy.example.com`
- `http://proxy-server.com:8080`

### 4. 保存设置

点击"保存"按钮使配置生效

## 代理工作原理

启用代理后，所有 AI API 请求会通过配置的代理服务器转发：

```
WriteAI → 代理服务器 → AI API (Qwen/Gemini/ChatGPT)
```

代理服务器会在 API URL 前添加代理前缀，例如：

- 原始 URL: `https://api.openai.com/v1/chat/completions`
- 通过代理: `http://localhost:7890/https://api.openai.com/v1/chat/completions`

## 常见代理工具配置

### Clash

1. 打开 Clash
2. 查看 HTTP 代理端口（通常是 7890）
3. 在 WriteAI 中输入：`http://localhost:7890`

### V2Ray

1. 打开 V2Ray
2. 查看 HTTP 代理端口（通常是 10809）
3. 在 WriteAI 中输入：`http://127.0.0.1:10809`

### Shadowsocks

1. 打开 Shadowsocks
2. 查看本地代理端口（通常是 1087）
3. 在 WriteAI 中输入：`http://localhost:1087`

### 系统代理

如果你的系统已配置全局代理，可以使用系统代理地址：

- Windows: 检查"Internet 选项" → "连接" → "局域网设置"
- macOS: 检查"系统偏好设置" → "网络" → "高级" → "代理"

## 注意事项

### ⚠️ 安全提醒

1. **仅使用可信的代理服务器**

   - API Key 会通过代理服务器传输
   - 确保代理服务器安全可靠

2. **本地代理优先**
   - 优先使用本地代理工具
   - 避免使用不明来源的远程代理

### 🔧 故障排除

**问题：启用代理后无法生成内容**

解决方案：

1. 检查代理地址是否正确
2. 确认代理服务器正在运行
3. 测试代理是否可以访问外网
4. 尝试在浏览器中使用相同代理访问 AI API

**问题：代理配置后速度很慢**

解决方案：

1. 检查代理服务器的网络质量
2. 尝试切换其他代理节点
3. 如果本地网络可以直连，可以关闭代理

**问题：特定 AI 提供商无法使用**

解决方案：

1. 某些代理可能限制特定域名
2. 尝试切换不同的代理服务器
3. 检查代理工具的规则配置

## 禁用代理

如果不再需要代理：

1. 打开设置
2. 关闭"启用代理服务器"开关
3. 点击"保存"

系统会直接连接 AI API，不经过代理服务器。

## 持久化存储

代理配置会自动保存到浏览器 localStorage：

- 启用/禁用状态
- 代理服务器地址

下次打开应用时会自动恢复配置。

## 技术细节

### 实现方式

代理功能在客户端实现，通过修改 API 请求 URL 实现：

```typescript
// 不使用代理
const apiUrl = "https://api.openai.com/v1/chat/completions";

// 使用代理
const apiUrl = `${proxyUrl}/https://api.openai.com/v1/chat/completions`;
```

### 支持的 AI 平台

所有三个 AI 平台都支持代理：

- ✅ 通义千问 (Qwen)
- ✅ Google Gemini
- ✅ ChatGPT (OpenAI)

### 数据安全

- API Key 始终加密传输（HTTPS）
- 代理地址仅存储在本地浏览器
- 不会发送到任何第三方服务器

## 常见使用场景

### 场景 1：国内访问 OpenAI

```
配置：
- 启用代理：是
- 代理地址：http://localhost:7890
- AI 提供商：ChatGPT
```

### 场景 2：公司内网访问

```
配置：
- 启用代理：是
- 代理地址：http://corporate-proxy.company.com:8080
- AI 提供商：根据需要选择
```

### 场景 3：直连访问

```
配置：
- 启用代理：否
- AI 提供商：通义千问（国内可直连）
```

## 更新日志

### v1.1.0

- ✅ 添加代理服务器配置功能
- ✅ 支持启用/禁用代理
- ✅ 代理配置持久化存储
- ✅ 所有 AI 平台支持代理
